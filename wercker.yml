box: microsoft/aspnetcore-build:2.0
no-response-timeout: 10
build:
  steps:    
    - script:
        name: restore
        code: |
          dotnet restore ./WebCalculator.Api/
    - script:
        name: build
        code: |
          dotnet build ./WebCalculator.Api/
    - script:
        name: publish
        code: |
          dotnet publish  ./WebCalculator.Api/ -o publish	 
    - script:
        name: copy binary
        code: |
          cp -r . $WERCKER_OUTPUT_DIR/app 
          cd $WERCKER_OUTPUT_DIR/app
deploy:
  box: microsoft/aspnetcore:2.0
  steps:
    - internal/docker-push:
        working-dir: $WERCKER_ROOT
        tag: $WERCKER_GIT_COMMIT
        ports: "80"
        username: _json_key
        password: $GCP_KEY_JSON
        repository: $GCR_TAG
        registry: $GCR_HOST
        cmd: dotnet WebCalculator.Api.dll
        entrypoint: /pipeline/source/app